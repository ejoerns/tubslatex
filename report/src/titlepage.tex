%% The environment where the TUBS titlepage can be constructed.
\newenvironment{TUBStitlepage}{%
  \begin{titlepage}
  \begin{tikzpicture}[remember picture,overlay]
  % Need something in the background?
  \end{tikzpicture}
}{%
  \ifthenelse{\equal{\TUBSDesignHelper}{true}}{\TUBSShowGaussGrid}{}
  \begin{tikzpicture}[remember picture,overlay]
    \ifthenelse{\equal{\RightSign}{1}}{%
      \def\switchsides{\TUBSCommunicationWidth mm%
        + 2* \TUBSFrameWidth mm - \TUBSLogoWidth mm}%
    }{\def\switchsides{0}}

    \node[inner sep=0,
      outer sep=0,
      xshift=\switchsides,
      yshift=\TUBSBottomMargin mm + \TUBSCommunicationHeight mm
        + \DirectionSign * 0.25 * \TUBSLogoHeight mm,
      minimum width=\TUBSLogoWidth mm,
      minimum height=\TUBSLogoHeight mm, inner sep=0pt, draw=none]
      (tulogoposition) at (\DirectionOrigin){};
    \node[xshift=\RightSign * 5mm,
      at=(tulogoposition),
      inner sep=0, outer sep=0,
      right, minimum width=\TUBSLogoWidth mm + 5mm,
      minimum height=\TUBSLogoHeight mm,
      fill=tuRed]
      (tulogo_overprint){};
    \ifthenelse{\equal{\TUBSDesignHelper}{true}}{%
      \node[pattern=north east lines,
        xshift= -0.25*\TUBSLogoHeight mm,at=(tulogoposition),
        inner sep=0, draw, outer sep=0,
        right, minimum width=0.5*\TUBSLogoHeight mm + \TUBSLogoWidth mm,
        minimum height=1.5*\TUBSLogoHeight mm]
        (tulogo_overprint){};}{}
    \node[at=(tulogoposition),inner sep=0, outer sep=0,right]
      (tulogo){\tubslogo};

    % Determinating if the logoposition is on the left or right and either the
    % institutelogo or the institutename text (or both) do not exist.
    \ifthenelse{\equal{\RightSign}{-1}}{%
      \node[inner sep=0, outer sep=0,
        xshift=\TUBSFrameWidth mm +\TUBSCommunicationWidth mm,
        yshift=\TUBSBottomMargin mm +\TUBSCommunicationHeight mm
        + 0.5*\DirectionSign * \TUBSAdresserHeight mm]
        (instlogoposition) at (\DirectionOrigin){};
      \def\leftright{left}
      \def\eastwest{west}
    }{%
      \node[inner sep=0, outer sep=0,
        xshift=\TUBSFrameWidth mm,
        yshift=\TUBSBottomMargin mm + \TUBSCommunicationHeight mm
        + 0.5*\DirectionSign * \TUBSAdresserHeight mm]
        (instlogoposition) at (\DirectionOrigin){};
      \def\leftright{right}
      \def\eastwest{east}
    }
    \ifthenelse{\equal{\@tubsinstlogo}{}}{}{%
      \node(instlogo)[at=(instlogoposition),\leftright,
        minimum height=\TUBSInstituteLogoHeight mm,
        inner sep=0pt, draw=none]
        {\includegraphics[height=\TUBSInstituteLogoHeight mm]{\@tubsinstlogo}};
    }
    \ifthenelse{\equal{\@tubsinstname}{}}{}{%
      \ifthenelse{\equal{\@tubsinstlogo}{}}{%
        % The xshift is important, because the tabular environment generates
        % a border on the right an left side. But you need the tabular environment
        % because you want to force a linebreak (\\) and at the same moment it has
        % to be aligned at the right side.
        \node(instname)[at=(instlogoposition),\leftright,
          inner sep=0, outer sep=0,
          text badly ragged,
          xshift=\RightSign * -2.5mm]
          {\begin{tabular}{l}\@tubsinstname\end{tabular}};
      }{%
        \node(instname)[at=(instlogo.\eastwest),\leftright,
          inner sep=0, outer sep=0,
          text badly ragged,
          xshift=\RightSign * -2.5mm
            + \RightSign * \TUBSDistanceBetweenInstituteLogoAndName mm]
          {\begin{tabular}{l}\@tubsinstname\end{tabular}};
      }
    }
  \end{tikzpicture}
  \end{titlepage}
}