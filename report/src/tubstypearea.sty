\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{tubstypearea}% 'tubslayout'?

\RequirePackage{ifthen}
\RequirePackage{geometry}
\RequirePackage[absolute]{textpos}
\RequirePackage{calc}

\newboolean{tubspage@landscape}\setboolean{tubspage@landscape}{false}

% calculates dimensions for LaTeXs page layout
\newcommand{\tubspage@calclayout}{%
%   \setlength{\topmargin}{0mm}%
%   \setlength{\voffset}{\tubspage@borderwidth-1in}
%   \setlength{\topskip}{0mm}
%   \setlength{\headsep}{\tubspage@borderwidth}
%   \setlength{\headheight}{\tubspage@senderheight-2\tubspage@borderwidth}
%   \setlength{\hoffset}{-1in}
%   \addtolength\hoffset\tubspage@borderwidth
%   \evensidemargin=0pt
%   \oddsidemargin=0pt
%   \setlength\textwidth{\paperwidth}
%   \addtolength\textwidth{-2\tubspage@borderwidth}
%   \setlength\textheight\tubspage@communicationheight
  \geometry{%
    a5paper,
    headheight=\tubspage@senderheight-2\tubspage@borderwidth,
    headsep=\tubspage@borderwidth,
    top=\tubspage@senderheight,
    left=\tubspage@borderwidth,
    right=\tubspage@borderwidth,
    bottom=\tubspage@borderwidth}
  %
  % dimension is a hack..
  \setlength{\TPHorizModule}{%
    (\textwidth-2\tubspage@borderwidth)*\ratio{1mm}{\tubspage@xsegments mm}}
  \setlength{\TPVertModule}{%
    (\textheight-2\tubspage@borderwidth)*\ratio{1mm}{\tubspage@ysegments mm}}
  \textblockorigin{2\tubspage@borderwidth}{%
    \tubspage@senderheight+\tubspage@borderwidth}
}

\newlength{\tubspage@borderwidth}
\newlength{\tubspage@senderheight}
\newlength{\tubspage@communicationheight}
\def\tubspage@xsegments{6}
\def\tubspage@ysegments{8}

% landscape
\DeclareOption{landscape}{%
  \setboolean{tubspage@landscape}{true}
}
% A0
\DeclareOption{a0paper}{%
  \ifthenelse{\boolean{tubspage@landscape}}{%
    \setlength{\tubspage@communicationheight}{649mm}%
    \def\tubspage@ysegments{6}%
  }{%
    \setlength{\tubspage@communicationheight}{997mm}%
    \def\tubspage@ysegments{8}%
  }
  \setlength{\tubspage@borderwidth}{32mm}%
  \setlength{\tubspage@senderheight}{160mm}%
  \tubspage@calclayout
}
% ...
% A3
\DeclareOption{a3paper}{%
  \ifthenelse{\boolean{tubspage@landscape}}{%
    \setlength{\tubspage@communicationheight}{226mm}%
    \def\tubspage@ysegments{6}%
  }{%
    \setlength{\tubspage@communicationheight}{349mm}%
    \def\tubspage@ysegments{8}%
  }
  \setlength{\tubspage@borderwidth}{11mm}%
  \setlength{\tubspage@senderheight}{60mm}%
  \tubspage@calclayout
}
% A4
\DeclareOption{a4paper}{%
  \ifthenelse{\boolean{tubspage@landscape}}{%
    \setlength{\tubspage@communicationheight}{162mm}%
    \def\tubspage@ysegments{6}%
  }{%
    \setlength{\tubspage@communicationheight}{249mm}%
    \def\tubspage@ysegments{8}%
  }
  \setlength{\tubspage@borderwidth}{8mm}%
  \setlength{\tubspage@senderheight}{40mm}%
  \tubspage@calclayout
}
% A5
\DeclareOption{a5paper}{%
  \ifthenelse{\boolean{tubspage@landscape}}{%
    \setlength{\tubspage@communicationheight}{112.5mm}%
  }{%
    \setlength{\tubspage@communicationheight}{174.5mm}%
  }
  \setlength{\tubspage@borderwidth}{5.5mm}%
  \setlength{\tubspage@senderheight}{30mm}%
  \tubspage@calclayout
}
% A6
\DeclareOption{a6paper}{%
  \ifthenelse{\boolean{tubspage@landscape}}{%
    \setlength{\tubspage@communicationheight}{75mm}%
  }{%
    \setlength{\tubspage@communicationheight}{118mm}%
  }
  \setlength{\tubspage@borderwidth}{5mm}%
  \setlength{\tubspage@senderheight}{25mm}%
  \tubspage@calclayout
}
% any
\DeclareOption{anypaper}{%
  % calculate dimensions
  % ...
%   \tubspage@calclayout
}

% \ExecuteOptions{anypaper}
\ProcessOptions\relax


\newlength{\tubspage@columnsep}
\setlength{\tubspage@columnsep}{5mm}



\newlength{\tubsbox@leftmargin}
\newlength{\tubsbox@rightmargin}
\newsavebox{\storebox}
\newcounter{tubsbox@lastelement}
% params:
% 1 - color
% 2 - xpos
% 3 - ypos
% 4 - width [1-6]
% 5 - height [1-6] / [1-8]
\newenvironment{tubsbox}[5][tuWhite]{%
% calc left margin in box
\ifnum#2=0
\setlength{\tubsbox@leftmargin}{\tubspage@borderwidth}
\else
\setlength{\tubsbox@leftmargin}{0mm}
\fi
\setcounter{tubsbox@lastelement}{#2}
\addtocounter{tubsbox@lastelement}{#4}
\ifnum\value{tubsbox@lastelement}=\tubspage@xsegments
\setlength{\tubsbox@rightmargin}{\tubspage@borderwidth}
\else
\setlength{\tubsbox@rightmargin}{0mm}
\fi
\def\bgcolor{#1}
\def\tubsbox@xpos{#2}
\def\tubsbox@ypos{#3}
\def\tubsbox@width{#4}
\def\tubsbox@height{#5}
\begin{lrbox}{\storebox}
% \hspace*{\tubspage@leftsep}%
\begin{minipage}[t]%
  [\tubsbox@height\gaussheight]%
  {\tubsbox@width\TPHorizModule}%
  \vspace*{\tubspage@borderwidth}%
}{%
\end{minipage}
\end{lrbox}
\setlength{\fboxsep}{0cm}%
\begin{textblock}{\tubsbox@width}(\tubsbox@xpos,\tubsbox@ypos)%
\hspace*{-\tubsbox@leftmargin}%
\colorbox{\bgcolor}{%
\hspace*{\tubsbox@leftmargin}%
\usebox{\storebox}%
\hspace*{\tubsbox@rightmargin}%
}%
\end{textblock}
}


% y segments
% x
% border
% senderheight
% communicationheight

% portrait:
%   senderheight = 1/7 paperheight
% landscape:
%   senderheight = 1/5 paperheight

% missing formats can be added by simple style file...