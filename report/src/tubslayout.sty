\ProvidesPackage{tubslayout}
% sys packages
\RequirePackage{ifthen}
\RequirePackage{calc}
\usepackage[draft]{flowfram}
% cd packages
\RequirePackage{tubscolors}
\RequirePackage[a4paper]{tubslogo}
\RequirePackage[a4paper]{tubstypearea}
\RequirePackage{nexus}

% sets background to 6 specified colors
% params:
% 1 (opt) - pages to set color for
% 2       - color of first element
% 3       - color of second element
% ...
% 9       - color of last element
\newcommand{\tubsSetBackground}[9][1]{%
\hNtoneleft[#1][\tubspage@borderwidth]{8}{\paperwidth-\tubspage@borderwidth}%
% {\textwidth}{tuWhite}{lborder}%
{1\tubspage@gaussheight}{#9}{bg1}%
{2\tubspage@gaussheight}{#8}{bg2}%
{3\tubspage@gaussheight}{#7}{bg3}%
{4\tubspage@gaussheight}{#6}{bg4}%
{5\tubspage@gaussheight}{#5}{bg5}%
{6\tubspage@gaussheight}{#4}{bg6}%
{7\tubspage@gaussheight}{#3}{bg7}%
{8\tubspage@gaussheight}{#2}{bg8}%
% left white border
\vNtonetop[all]{1}{\paperheight}{\tubspage@borderwidth}{tuWhite}{lborder}
}


\newlength{\tubslayout@logooffset}
% sets the tu logo
% params:
% 1 (opt.)  - placement (left, right), default=left
\newcommand{\tubslayout@setlogo}[1][left]{%
\ifthenelse{\equal{#1}{right}}{%
  \setlength{\tubslayout@logooffset}{\paperwidth-\tulogoWidth}
}{%
  \setlength{\tubslayout@logooffset}{0mm}
}
\newstaticframe[1]{\tulogoWidth}{\tulogoHeight}%
  {-2\tubspage@borderwidth+\tubslayout@logooffset}%
  {-\tubspage@borderwidth-0.5em+36\tubspage@gaussheight-0.25\tulogoHeight}%
  [tubslogo]
\setstaticcontents*{tubslogo}{\tubslogo}
\setstaticframe*{tubslogo}{backcolor=tuRed}
}

\tubslayout@setlogo[right]

\newdynamicframe[1]{\textwidth}{\tubspage@gaussheight}{0pt}{0pt}[author]

\setdynamiccontents*{author}{%
  \sffamily\Huge Enrico JÃ¶rns
}


% calculates gaussum and returns as plain number
% parameters:
% 1 - counter to set
% 2 - value to calc sum of
\newcommand{\calc@gaussum}[2]{%
\setcounter{#1}{%
  (#2*(#2+1))/2}%
}

\newlength{\temp@xpos}
\newlength{\temp@ypos}
\newlength{\temp@width}
\newlength{\temp@height}
\newcounter{temp@gausspos}
\newcounter{temp@gaussposb}


% params:
% 1 (opt.)  - name
% 1         - row number
% 2         - row span
\newcommand{\newdynamictubsframe}[3][title]{%
\def\mk@frameId{title}% new frame id
\calc@gaussum{temp@gausspos}{(\tubspage@ysegments-(#2)-(#3-1))}\addtocounter{temp@gausspos}{-1}
\setlength\temp@ypos{\value{temp@gausspos}\tubspage@gaussheight}
\calc@gaussum{temp@gaussposb}{(\tubspage@ysegments-(#2-1))}\addtocounter{temp@gaussposb}{-1}
\addtocounter{temp@gaussposb}{-\thetemp@gausspos}
\setlength\temp@height{\thetemp@gaussposb\tubspage@gaussheight}
\setlength\temp@width\textwidth
\setlength\temp@xpos{0pt}

\newdynamicframe[1]{\temp@width}{\temp@height}{\temp@xpos}{\temp@ypos}[title]

\setdynamiccontents*{title}{%
  \sffamily%
  \Huge Result: \thetemp@gausspos, \thetemp@gaussposb This Is My Title\\\vfill
  \LARGE An perhaps a subtitle
}
}

\newdynamictubsframe{5}{3}

\setlength{\temp@ypos}{-\tubspage@borderwidth+16\tubspage@gaussheight-0.5em}
\setlength{\temp@width}{\textwidth+2\tubspage@borderwidth}
\newdynamicframe[1]{\temp@width}{\temp@ypos}{-\tubspage@borderwidth}{%
20\tubspage@gaussheight}[image]

\setdynamicframe*{image}{%
%   x=\tubspage@borderwidth
}
\setdynamiccontents*{image}{%
\includegraphics[width=\textwidth+2\tubspage@borderwidth]{%
../../beamer/doc/titlepicture.jpg}
}

